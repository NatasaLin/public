/*!	
 *	@author		HitkoDev http://hitko.eu/videobox
 *	@copyright	Copyright (C) 2016 HitkoDev All Rights Reserved.
 *	@license	http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
 *
 *	This program is free software: you can redistribute it and/or modify
 *	it under the terms of the GNU General Public License as published by
 *	the Free Software Foundation, either version 3 of the License, or
 *	any later version.
 *
 *	This program is distributed in the hope that it will be useful,
 *	but WITHOUT ANY WARRANTY; without even the implied warranty of
 *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 *	GNU General Public License for more details.
 *
 *	You should have received a copy of the GNU General Public License
 *	along with this program. If not, see <http://www.gnu.org/licenses/>
 */
function create(t,i,e){return t=document.createElement(t),i&&(t.id=i),e&&(t.onclick=e),t}function createClass(t,i,e){return t=document.createElement(t),i&&(t.className=i),e&&(t.onclick=e),t}function iterableToArray(t){for(var i=[],e=0;e<t.length;e++)i.push(t[e]);return i}function applyStyles(t,i){for(var e in i)e in t.style&&(t.style[e]=i[e])}function hide(t){t.originalDisplay=t.style.display&&("none"==t.style.display?"":t.style.display)||"",t.style.display="none"}function show(t){t.style.display="originalDisplay"in t&&t.originalDisplay?t.originalDisplay:""}function insertAfter(t,i){i.parentElement.insertBefore(t,i.nextSibling)}function toggleClass(t,i,e){(t.classList.contains(i)?!e:e)&&t.classList.toggle(i)}function libBind(t){t.videobox=function(t){VideoboxObj.open(t)},t.vbClose=function(){VideoboxObj.close()},t.fn.videobox=function(t,i){t=void 0===t?{}:t;var e=iterableToArray(this);i?VideoboxObj.bind(e,t,i):VideoboxObj.bind(e,t)}}function libBind$1(t){t.vbInline=function(t){VbInlineObj.open(t)},t.vbiClose=function(t){VbInlineObj.close(t)},t.fn.vbInline=function(t,i){t=void 0===t?{}:t;var e=iterableToArray(this);i?VbInlineObj.bind(e,t,i):VbInlineObj.bind(e,t)}}function detach(t){t.forEach(function(t){"querySelector"in t&&t.querySelector("#vbiWrap")&&VbInlineObj.close(),t.parentNode.removeChild(t)})}function libBind$2(t){t.vbSlider=function(t,i){return i=void 0===i?{}:i,"length"in t&&(t=t[0]),VbSlider.getSlider(t,i)},t.fn.vbSlider=function(t){t=void 0===t?{}:t;var i=iterableToArray(this);return VbSlider.bind(i,t)}}function bindAll(){VideoboxObj.bind("a[rel^='videobox']"),VbInlineObj.bind("a[rel^='vbinline']"),VbSlider.bind(".vb_slider")}var $jscomp={scope:{},getGlobal:function(t){return"undefined"!=typeof window&&window===t?t:"undefined"!=typeof global&&null!=global?global:t}};$jscomp.global=$jscomp.getGlobal(this),$jscomp.owns=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(t,i,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");t!=Array.prototype&&t!=Object.prototype&&(t[i]=e.value)},$jscomp.polyfill=function(t,i,e,o){if(i){for(e=$jscomp.global,t=t.split("."),o=0;o<t.length-1;o++){var n=t[o];n in e||(e[n]={}),e=e[n]}t=t[t.length-1],o=e[t],i=i(o),i!=o&&null!=i&&$jscomp.defineProperty(e,t,{configurable:!0,writable:!0,value:i})}},$jscomp.polyfill("Object.assign",function(t){return t?t:function(t,i){for(var e=1;e<arguments.length;e++){var o=arguments[e];if(o)for(var n in o)$jscomp.owns(o,n)&&(t[n]=o[n])}return t}},"es6-impl","es3"),$jscomp.findInternal=function(t,i,e){t instanceof String&&(t=String(t));for(var o=t.length,n=0;n<o;n++){var s=t[n];if(i.call(e,s,n,t))return{i:n,v:s}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(t){return t?t:function(t,i){return $jscomp.findInternal(this,t,i).v}},"es6-impl","es3");var Videobox=function(t,i,e){i=void 0===i?{}:i;var o=this;this.isOpen=!1,this.animations=[],this.defaults={width:720,height:405,closeText:"Close",padding:30,closeKeys:[27,81],hideBottom:!1,root:document.body,animation:{duration:500,iterations:1,delay:0,easing:"ease-in-out"}},this.overlay=create("div","vbOverlay",function(){return o.close()}),this.wrap=create("div","vbWrap"),this.center=create("div","vbCenter"),this.wrap.appendChild(this.center),this.responsive=create("div","vbResponsive"),this.center.appendChild(this.responsive),this.bottomContainer=create("div","vbBottomContainer"),this.center.appendChild(this.bottomContainer),this.video=create("iframe","vbVideo"),this.video.allowFullscreen=!0,this.video.frameBorder="0px",hide(this.video),this.responsive.appendChild(this.video),this.bottom=create("div","vbBottom"),this.bottomContainer.appendChild(this.bottom),this.button=create("a","vbCloseLink",function(){return o.close()}),this.button.innerHTML='<span id="vbCloseText">'+this.defaults.closeText+'</span><i class="vb-icon-close"></i>',this.bottom.appendChild(this.button),this.caption=create("strong","vbCaption"),this.bottom.appendChild(this.caption),this.closeText=this.button.querySelector("#vbCloseText"),window.addEventListener("resize",function(){o.isOpen&&o.activeVideo&&o.setPlayerSizePosition()}),window.addEventListener("keyup",function(t){o.activeVideo&&0<=o.activeVideo.options.closeKeys.indexOf(t.keyCode)&&o.close()}),t&&this.bind(t,i,e||this.linkMapper)};Videobox.prototype.bind=function(t,i,e){i=void 0===i?{}:i,e=void 0===e?this.linkMapper:e;var o=this;"string"==typeof t&&(t=iterableToArray(document.querySelectorAll(t))),t.forEach(function(t){t.vbListener&&t.removeEventListener("click",t.vbListener),t.vbiListener&&t.removeEventListener("click",t.vbiListener),t.vbListener=function(n){return n.preventDefault(),n.stopPropagation(),n=e(t),n.options=Object.assign({},i,n.options),o.open(n),!1},t.addEventListener("click",t.vbListener)})},Videobox.prototype.open=function(t){"VbInline"in window&&window.VbInline.close(),this.close(),t.options=Object.assign({},this.defaults,t.options),t.options.root||(t.options.root=document.body),this.setup(t);var i=t.origin.target,i=i.querySelector(i.getAttribute("data-target"))||i,e=this.wrap.getBoundingClientRect(),o=i.getBoundingClientRect();toggleClass(i,"vb_line_fix",!0),t.origin=Object.assign({},{x:o.left-e.left+i.clientWidth/2,y:o.top-e.top+i.clientHeight/2,width:i.clientWidth,height:i.clientHeight},t.origin),toggleClass(i,"vb_line_fix",!1),this.changeVideo(t)},Videobox.prototype.close=function(){return this.stop(),[this.wrap,this.bottomContainer,this.overlay].forEach(function(t){return toggleClass(t,"visible",!1)}),this.wrap.style.top="0px",this.wrap.style.left="0px",this.activeVideo=null,!1},Videobox.prototype.setPlayerSizePosition=function(){if(this.activeVideo){this.setPlayerPosition(this.activeVideo.options.root);var t=this.activeVideo.options.width,i=this.activeVideo.options.height;if(t+2*this.activeVideo.options.padding>this.wrap.clientWidth)var e=this.wrap.clientWidth-2*this.activeVideo.options.padding,i=i*e/t,t=e;return i+2*this.activeVideo.options.padding>this.wrap.clientHeight&&(i=this.wrap.clientHeight-2*this.activeVideo.options.padding),t=100*i/t,this.responsive.style.paddingBottom=t+"%",t}},Videobox.prototype.linkMapper=function(t){var i=JSON.parse(t.getAttribute("data-videobox"))||{};if(i.root){var e=i.root;"string"==typeof e&&(e=iterableToArray(document.querySelectorAll(e))),0<e.length?i.root=e[0]:i.pop("root")}return{url:t.getAttribute("href")||"",title:t.getAttribute("title")||"",options:i,origin:{target:t}}},Videobox.prototype.setup=function(t){this.closeText.innerText=t.options.closeText,t.options.root.appendChild(this.overlay),t.options.root.appendChild(this.wrap),this.setPlayerPosition(t.options.root)},Videobox.prototype.setPlayerPosition=function(t){t=this.wrap.offsetParent;var i=this.wrap.getBoundingClientRect(),e=this.overlay.getBoundingClientRect(),o=this.wrap.offsetLeft-t.offsetLeft,n=e.left-i.left;this.wrap.style.top=this.wrap.offsetTop-t.offsetTop+(e.top-i.top)+"px",this.wrap.style.left=o+n+"px"},Videobox.prototype.changeVideo=function(t){var i=this;this.activeVideo=t,this.caption.innerHTML=this.activeVideo.title;var e=this.setPlayerSizePosition();this.isOpen=!0;var o={top:this.activeVideo.origin.y-this.wrap.clientHeight/2+"px",left:this.activeVideo.origin.x-this.wrap.clientWidth/2+"px",maxWidth:this.activeVideo.origin.width+"px"};t={top:"0px",left:"0px",maxWidth:this.activeVideo.options.width+"px"},applyStyles(this.center,o),[this.wrap,this.overlay].forEach(function(t){return toggleClass(t,"visible",!0)}),toggleClass(this.wrap,"animating",!0);var n=100*this.activeVideo.origin.height/this.activeVideo.origin.width||e;n!=e&&this.animations.push(this.responsive.animate([{paddingBottom:n+"%"},{paddingBottom:e+"%"}],this.activeVideo.options.animation)),e=this.center.animate([o,t],this.activeVideo.options.animation),e.onfinish=function(){return i.animateBotton()},this.animations.push(e),applyStyles(this.center,t),e.play()},Videobox.prototype.animateBotton=function(){var t=this;if(this.activeVideo.options.hideBottom)this.showVideo();else{var i=this.bottomContainer.animate([{maxHeight:"0px"},{maxHeight:"200px"}],this.activeVideo.options.animation);toggleClass(this.bottomContainer,"visible",!0),i.onfinish=function(){return t.showVideo()},this.animations.push(i),i.play()}},Videobox.prototype.showVideo=function(){this.isOpen&&!this.video.getAttribute("src")&&(show(this.video),this.video.setAttribute("src",this.activeVideo.url),toggleClass(this.wrap,"animating",!1))},Videobox.prototype.stop=function(){this.animations.forEach(function(t){return t.cancel()}),this.animations=[],this.isOpen=!1,this.video.setAttribute("src",""),hide(this.video),toggleClass(this.wrap,"animating",!1)};var VideoboxObj=new Videobox;window.Videobox=VideoboxObj,"undefined"!=typeof jQuery&&(jQuery.videobox=function(t){VideoboxObj.open(t)},jQuery.vbClose=function(){VideoboxObj.close()},jQuery.fn.videobox=function(t,i){t=void 0===t?{}:t;var e=iterableToArray(this);i?VideoboxObj.bind(e,t,i):VideoboxObj.bind(e,t)}),"undefined"!=typeof jQuery&&libBind(jQuery),"undefined"!=typeof Zepto&&libBind(Zepto);var VbInline=function(t,i,e){i=void 0===i?{}:i;var o=this;this.hidding=this.isOpen=!1,this.animations=[],this.hidden=[],this.defaults={width:720,height:405,closeText:"Close",padding:30,closeTimeout:1e3,closeKeys:[27,81],animation:{duration:500,iterations:1,delay:0,easing:"ease-in-out"}},this.wrap=create("div","vbiWrap"),this.responsive=create("div","vbiResponsive"),this.wrap.appendChild(this.responsive),this.caption=document.createElement("span"),this.caption.className="vb_video_title",this.wrap.appendChild(this.caption),this.button=create("div","vbiClose",function(){return o.close()}),this.button.innerHTML='<i class="vb-icon-circle-close-invert"></i>',this.wrap.appendChild(this.button),this.video=create("iframe","vbiVideo"),this.video.allowFullscreen=!0,this.video.frameBorder="0px",hide(this.video),this.responsive.appendChild(this.video),window.addEventListener("keyup",function(t){o.activeVideo&&0<=o.activeVideo.options.closeKeys.indexOf(t.keyCode)&&o.close()}),t&&this.bind(t,i,e||this.linkMapper)};VbInline.prototype.bind=function(t,i,e){i=void 0===i?{}:i,e=void 0===e?this.linkMapper:e;var o=this;"string"==typeof t&&(t=iterableToArray(document.querySelectorAll(t))),t.forEach(function(t){t.vbListener&&t.removeEventListener("click",t.vbListener),t.vbiListener&&t.removeEventListener("click",t.vbiListener),t.vbiListener=function(n){return n.preventDefault(),n.stopPropagation(),n=e(t),n.options=Object.assign({},i,n.options),o.open(n),!1},t.addEventListener("click",t.vbiListener)})},VbInline.prototype.open=function(t){var i=this;"Videobox"in window&&window.Videobox.close(),t.options=Object.assign({},this.defaults,t.options);var e=t.origin.target,e=e.querySelector(e.getAttribute("data-target"))||e;toggleClass(e,"vb_line_fix",!0),t.origin=Object.assign({},{x:e.clientWidth/2,y:e.clientHeight/2,width:e.clientWidth,height:e.clientHeight},t.origin),toggleClass(e,"vb_line_fix",!1),this.close(function(){return i.changeVideo(t)})},VbInline.prototype.close=function(t){var i=this;if(this.stop(),!this.hidding)if(this.wrap.parentElement&&this.activeVideo){this.hidding=!0;var e=this.activeVideo.origin.width+"px",o=this.wrap.animate([{maxWidth:this.activeVideo.options.width+2*this.activeVideo.options.padding+"px"},{maxWidth:e}],this.activeVideo.options.animation);o.onfinish=function(){return i.hide(t)},this.wrap.style.maxWidth=e,o.play(),e=100*this.activeVideo.origin.height/this.activeVideo.origin.width+"%",o=this.responsive.animate([{paddingBottom:100*this.activeVideo.options.height/this.activeVideo.options.width+"%"},{paddingBottom:e}],this.activeVideo.options.animation),this.responsive.style.paddingBottom=e,o.play()}else this.hide(t);return!1},VbInline.prototype.linkMapper=function(t){return{url:t.getAttribute("href")||"",title:t.getAttribute("title")||"",options:JSON.parse(t.getAttribute("data-videobox"))||{},origin:{target:t}}},VbInline.prototype.setup=function(){insertAfter(this.wrap,this.activeVideo.origin.target),hide(this.activeVideo.origin.target),this.hidden.push(this.activeVideo.origin.target)},VbInline.prototype.changeVideo=function(t){var i=this;this.activeVideo=t,this.setup(),this.wrap.setAttribute("style",this.activeVideo.options.style),this.wrap.setAttribute("class",this.activeVideo.options.class),this.caption.innerHTML=this.activeVideo.title,toggleClass(this.button,"visible",!0),this.isOpen=!0;var e={maxWidth:this.activeVideo.options.width+2*this.activeVideo.options.padding+"px"},o=this.wrap.animate([{maxWidth:this.activeVideo.origin.width+"px"},e],this.activeVideo.options.animation);applyStyles(this.wrap,e),o.onfinish=function(){return i.showVideo()},this.animations.push(o),o.play(),e={paddingBottom:100*this.activeVideo.options.height/this.activeVideo.options.width+"%"},o=this.responsive.animate([{paddingBottom:100*this.activeVideo.origin.height/this.activeVideo.origin.width+"%"},e],this.activeVideo.options.animation),o.onfinish=function(){i.timer=window.setTimeout(function(){return toggleClass(i.button,"visible",!1)},t.options.closeTimeout)},this.animations.push(o),o.play(),applyStyles(this.responsive,e)},VbInline.prototype.showVideo=function(){this.isOpen&&(show(this.video),this.video.setAttribute("src",this.activeVideo.url))},VbInline.prototype.hide=function(t){this.wrap.parentElement&&this.wrap.parentNode.removeChild(this.wrap),this.hidden.forEach(function(t){return show(t)}),this.hidden=[],this.hidding=!1,this.activeVideo=null,"function"==typeof t&&t()},VbInline.prototype.stop=function(){this.animations.forEach(function(t){return t.cancel()}),this.animations=[],this.isOpen=!1,this.video.setAttribute("src",""),window.clearTimeout(this.timer),hide(this.video)};var VbInlineObj=new VbInline;window.VbInline=VbInlineObj,"undefined"!=typeof jQuery&&libBind$1(jQuery),"undefined"!=typeof Zepto&&libBind$1(Zepto);var VbSlider=function(t,i){i=void 0===i?{}:i;var e=this;this.queue=[],this.timeout=-1,this.moving=!1,this.visible=-1,this.detachedElements=[],this.options={moveAll:!1,target:"",singleDuration:500,doubleClickTimeout:200,animation:{duration:500,iterations:1,delay:0,easing:"ease-in-out"}},this.outer=createClass("div","vb_slider_outer"),this.prev=createClass("div","vb_slider_prev",function(){return e.showPrev()}),this.prev.innerHTML='<i class="vb-icon-prev"></i>',this.outer.appendChild(this.prev),this.wrap=createClass("div","vb_slider_wrap"),this.outer.appendChild(this.wrap),this.next=createClass("div","vb_slider_next",function(){return e.showNext()}),this.next.innerHTML='<i class="vb-icon-next"></i>',this.outer.appendChild(this.next),this.content=createClass("div","vb_slider_cont"),this.wrap.appendChild(this.content),this.buttons=iterableToArray(this.outer.querySelectorAll("i")),this.target=t;var o=this.attached;insertAfter(this.outer,this.target),this.content.appendChild(this.target),this.basis=parseInt(t.getAttribute("data-width"))||o[0].clientWidth,this.options=Object.assign(this.options,i),toggleClass(this.content,"vb-slider__move-all",this.options.moveAll),this.setCount()};VbSlider.bind=function(t,i){i=void 0===i?{}:i;var e=this;"string"==typeof t&&(t=iterableToArray(document.querySelectorAll(t)));var o=[];return t.forEach(function(t){var n=(t.getAttribute("data-target")||"").trim(),s=(t.getAttribute("data-move")||"single").trim(),r={};n&&(r.target=n),s&&(r.moveAll="all"==s),o.push(e.getSlider(t,Object.assign({},i,r)))}),o},VbSlider.getSlider=function(t,i){i=void 0===i?{}:i;var e=this.sliders.find(function(i){return i.target==t});return e?(e.options=Object.assign(e.options,i),e):new VbSlider(t,i)},VbSlider.updateSizes=function(){this.sliders.forEach(function(t){return t.setCount()})},VbSlider.prototype.showPrev=function(){this.queueMove("r")},VbSlider.prototype.showNext=function(){this.queueMove("l")},VbSlider.prototype.setBasis=function(t){t!=this.basis&&(this.basis=t,this.setCount())},VbSlider.prototype.getTarget=function(){return this.target},VbSlider.prototype.queueMove=function(t){var i=this;0<this.queue.length&&this.queue[this.queue.length-1]!=t?this.queue.pop():this.queue.push(t),0<=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){i.timeout=-1,!i.moving&&0<i.queue.length&&i.move()},this.options.doubleClickTimeout)},VbSlider.prototype.move=function(){var t=this;this.moving=!0;for(var i=this.queue.pop(),e=this.target.clientHeight,o=1;0<this.queue.length;)o+=this.queue.pop()==i?1:-1;if(0==o)this.moving=!1;else{0>o&&(i="l"==i?"r":"l",o=0-o);var n=(this.options.moveAll?this.visible:1)*o,n=n%(this.visible+this.detachedElements.length);if("l"==i)for(o=0;o<n&&0<this.detachedElements.length;o++)this.target.appendChild(this.detachedElements.shift());else for(o=0;o<n&&0<this.detachedElements.length;o++)this.target.insertBefore(this.detachedElements.pop(),this.target.firstChild);var o=this.attached,s="l"==i?o.slice(0,o.length-this.visible):o.slice(this.visible);detach(s);var o=this.target.clientHeight,r=100*n/this.visible;if("l"==i)for(var a=s.length-1;0<=a;a--)this.target.insertBefore(s[a],this.target.firstChild);else for(a=0;a<s.length;a++)this.target.appendChild(s[a]);n=this.options.singleDuration?Object.assign({},this.options.animation,{duration:this.options.singleDuration*n}):this.options.animation,a=100*r/(r+100),s={transform:"translate("+("l"==i?0:-a)+"%)"},a={transform:"translate("+("l"==i?-a:0)+"%)"},this.content.style.width=r+100+"%",r=this.content.animate([s,a],n),r.addEventListener("finish",function(){t.content.style.width="100%",t.skip(i)}),r=this.content.animate([{height:e+"px"},{height:o+"px"}],n),this.content.style.height=o+"px";var h=0;this.options.target&&(h=(this.target.querySelector(this.options.target)||{offsetHeight:0}).offsetHeight/2),this.buttons.forEach(function(t){return t.style.top=h?h+"px":""})}},VbSlider.prototype.skip=function(t){var i=this,e=this.attached;"l"==t?(t=e.slice(0,e.length-this.visible),detach(t),t.forEach(function(t){return i.detachedElements.push(t)})):"r"==t&&(t=e.slice(this.visible),detach(t),t.forEach(function(t){return i.detachedElements.unshift(t)})),0<this.queue.length&&0>this.timeout?this.move():this.moving=!1},VbSlider.prototype.setCount=function(){var t=this.visible,i=this.target.clientWidth,e=this.attached,e=this.basis+e[0].offsetWidth-e[0].clientWidth,o=Math.floor(i/this.basis);1>o?o=1:e/(i/(o+1))<2-e/(i/o)&&o++,o!=t&&(this.visible=o,this.setAttached()),this.content.style.height=this.target.clientHeight+"px";var n=0;this.options.target&&(n=(this.target.querySelector(this.options.target)||{offsetHeight:0}).offsetHeight/2),this.buttons.forEach(function(t){return t.style.top=n?n+"px":""})},VbSlider.prototype.setAttached=function(){var t=this.attached;if(t.length<this.visible)for(t=t.length;t<this.visible&&0<this.detachedElements.length;t++)this.target.appendChild(this.detachedElements.shift());else if(t.length>this.visible)for(var i=t.length-1;i>=this.visible;i--)this.detachedElements.unshift(t[i]),detach([t[i]])},$jscomp.global.Object.defineProperties(VbSlider.prototype,{attached:{configurable:!0,enumerable:!0,get:function(){return iterableToArray(this.target.children)}},isMoving:{configurable:!0,enumerable:!0,get:function(){return this.moving}}}),VbSlider.sliders=[],window.addEventListener("resize",function(){return VbSlider.updateSizes()}),window.VbSlider=VbSlider,"undefined"!=typeof jQuery&&libBind$2(jQuery),"undefined"!=typeof Zepto&&libBind$2(Zepto),"loading"!=document.readyState?bindAll():document.addEventListener("readystatechange",function t(){"loading"!=document.readyState&&(document.removeEventListener("readystatechange",t),bindAll())});
//# sourceMappingURL=videobox.js.map
